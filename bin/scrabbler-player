#!/usr/bin/env python

import sys
import re

import scrabbler.player
import scrabbler.lexicon
import scrabbler.move

# Follow the stdin/stdout protocol
t = scrabbler.lexicon.Lexicon()
with open('/usr/share/dict/words') as f:
    for word in f:
        t.add(word.rstrip().upper())

if sys.argv >= 2:
    player = getattr(scrabbler.player,sys.argv[1])(t)
else:
    player = scrabbler.player.MaxScorePlayer(t)

# We're ready
sys.stdout.write("HELLO\n")
sys.stdout.flush()

while 1:
    line = sys.stdin.readline()

    if not line:
        break

    match = re.match('^([A-Z\?\*]*):(.*)', line)
    if match:
        if match.group(2):
            opponent_move = scrabbler.move.Move.from_str(match.group(2))
        else:
            opponent_move = None
        move = player.move( list(match.group(1)), opponent_move )

        if move:
            sys.stdout.write(str(move) + "\n")
            sys.stdout.flush()
        else:
            break
    else:
        raise ValueError("invalid line: " + line)
